 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/frontend/src/App.jsx b/frontend/src/App.jsx
index d2c9c1581ee114d721f281b6585d8c69eab58a22..3de11840a44acb9bbfb628738b47751d38e7499d 100644
--- a/frontend/src/App.jsx
+++ b/frontend/src/App.jsx
@@ -103,50 +103,205 @@ const signupHistory = [
 const normalizeServiceCharge = (value) => Math.max(0, Math.min(100, Number(value) || 0));
 
 const loadStoredServiceCharge = () => {
   const stored = localStorage.getItem(SERVICE_CHARGE_STORAGE_KEY);
   if (stored === null) return null;
 
   return normalizeServiceCharge(stored);
 };
 
 const persistServiceCharge = (rate) => {
   localStorage.setItem(SERVICE_CHARGE_STORAGE_KEY, String(rate));
 };
 
 const getSuspensionCutoffDate = () => {
   const today = new Date();
   return new Date(Date.UTC(today.getUTCFullYear(), today.getUTCMonth(), 15));
 };
 
 const isPastSuspensionCutoff = () => {
   const now = new Date();
   const cutoff = getSuspensionCutoffDate();
 
   return now.getTime() >= cutoff.getTime();
 };
 
+function useBillingCore() {
+  const billingCycleStart = useMemo(() => {
+    const today = new Date();
+    return new Date(Date.UTC(today.getUTCFullYear(), today.getUTCMonth(), 1)).toISOString().slice(0, 10);
+  }, []);
+
+  const [providers, setProviders] = useState(sampleProviders);
+  const [charges, setCharges] = useState(() =>
+    sampleCharges.map((charge) => {
+      const baseServiceCost = Math.round((charge.amount / DEFAULT_SERVICE_CHARGE) * 100);
+
+      return {
+        ...charge,
+        baseServiceCost,
+        isPaid: charge.month === billingCycleStart ? false : charge.isPaid ?? false,
+      };
+    }),
+  );
+  const [selectedChargeIds, setSelectedChargeIds] = useState([]);
+  const [creditInputs, setCreditInputs] = useState({});
+  const [loadingProviders, setLoadingProviders] = useState(false);
+  const [suspensionClock, setSuspensionClock] = useState(() => Date.now());
+  const suspensionCutoffLabel = useMemo(() => getSuspensionCutoffDate().toISOString().slice(0, 10), []);
+
+  useEffect(() => {
+    const interval = setInterval(() => setSuspensionClock(Date.now()), 1000 * 60 * 30);
+    return () => clearInterval(interval);
+  }, []);
+
+  useEffect(() => {
+    const fetchProviders = async () => {
+      try {
+        setLoadingProviders(true);
+        const res = await axios.get(`${API}/providers`);
+        if (Array.isArray(res.data) && res.data.length) {
+          const normalized = res.data.map((p) => ({
+            id: p.provider_id || p.id,
+            name: p.name || 'Provider',
+            location: p.location || 'Unknown area',
+            lat: p.lat,
+            long: p.long,
+            outstanding: Math.floor(Math.random() * 40000) + 5000,
+            credit: 0,
+            isLocked: false,
+            autoSuspended: false,
+            lastActive: '2024-10-10',
+            totalBookings: Math.floor(Math.random() * 40) + 5,
+            cancellations: Math.floor(Math.random() * 5),
+            noShows: Math.floor(Math.random() * 2),
+            services: p.services || [],
+          }));
+          setProviders(normalized);
+        }
+      } catch (e) {
+        console.log('Using sample providers', e.message);
+      } finally {
+        setLoadingProviders(false);
+      }
+    };
+
+    fetchProviders();
+  }, []);
+
+  useEffect(() => {
+    const inSuspensionWindow = isPastSuspensionCutoff();
+
+    setProviders((prev) =>
+      prev.map((provider) => {
+        const hasUnpaidCurrentCharge = charges.some(
+          (charge) => charge.providerId === provider.id && charge.month === billingCycleStart && !charge.isPaid,
+        );
+        const autoSuspended = inSuspensionWindow && hasUnpaidCurrentCharge;
+
+        if (provider.autoSuspended === autoSuspended) return provider;
+
+        return { ...provider, autoSuspended };
+      }),
+    );
+  }, [billingCycleStart, charges, suspensionClock]);
+
+  const providerById = useMemo(() => {
+    const map = {};
+    providers.forEach((p) => {
+      map[p.id] = p;
+    });
+    return map;
+  }, [providers]);
+
+  const resolvedCharges = useMemo(
+    () =>
+      charges.map((charge) => ({
+        ...charge,
+        providerName: providerById[charge.providerId]?.name || 'Provider',
+        isCurrentCycle: charge.month === billingCycleStart,
+      })),
+    [charges, providerById, billingCycleStart],
+  );
+
+  const applyCredit = (providerId) => {
+    const creditValue = Number(creditInputs[providerId] || 0);
+    if (!creditValue) return;
+    setProviders((prev) =>
+      prev.map((p) =>
+        p.id === providerId ? { ...p, credit: p.credit + creditValue, outstanding: Math.max(0, p.outstanding - creditValue) } : p,
+      ),
+    );
+    setCreditInputs((prev) => ({ ...prev, [providerId]: '' }));
+  };
+
+  const toggleLock = (providerId) => {
+    setProviders((prev) => prev.map((p) => (p.id === providerId ? { ...p, isLocked: !p.isLocked } : p)));
+  };
+
+  const toggleChargeSelection = (chargeId) => {
+    setSelectedChargeIds((prev) => (prev.includes(chargeId) ? prev.filter((id) => id !== chargeId) : [...prev, chargeId]));
+  };
+
+  const toggleAllChargesSelection = () => {
+    if (selectedChargeIds.length === charges.length) {
+      setSelectedChargeIds([]);
+    } else {
+      setSelectedChargeIds(charges.map((c) => c.id));
+    }
+  };
+
+  const setChargesPaidState = (paidState) => {
+    setCharges((prev) => prev.map((c) => (selectedChargeIds.includes(c.id) ? { ...c, isPaid: paidState } : c)));
+    setSelectedChargeIds([]);
+  };
+
+  const updateSingleChargeStatus = (chargeId, paidState) => {
+    setCharges((prev) => prev.map((c) => (c.id === chargeId ? { ...c, isPaid: paidState } : c)));
+    setSelectedChargeIds((prev) => prev.filter((id) => id !== chargeId));
+  };
+
+  return {
+    applyCredit,
+    billingCycleStart,
+    charges,
+    creditInputs,
+    loadingProviders,
+    providers,
+    resolvedCharges,
+    selectedChargeIds,
+    setCharges,
+    setCreditInputs,
+    setChargesPaidState,
+    suspensionCutoffLabel,
+    toggleAllChargesSelection,
+    toggleChargeSelection,
+    toggleLock,
+    updateSingleChargeStatus,
+  };
+}
+
 function Login({ onLogin }) {
   const [email, setEmail] = useState('admin@guyana.com');
   const [password, setPassword] = useState('pass');
   const navigate = useNavigate();
 
   const login = async () => {
     try {
       const res = await axios.post(`${API}/auth/login`, new URLSearchParams({
         username: email,
         password: password,
       }));
       const token = res.data.access_token;
       localStorage.setItem('token', token);
       axios.defaults.headers.common.Authorization = `Bearer ${token}`;
       onLogin?.(token);
       navigate('/admin');
     } catch {
       alert('Wrong credentials');
     }
   };
 
   return (
     <div
       style={{
         minHeight: '100vh',
@@ -373,133 +528,302 @@ function useLeafletMap(providers) {
             const marker = window.L.marker([provider.lat, provider.long]).addTo(mapInstance);
             marker.bindPopup(
               `<div style="font-weight:700">${provider.name}</div>` +
                 `<div style="color:#6b7280">${provider.location}</div>` +
                 `<div style="font-size:12px">Services: ${provider.services?.join(', ') || 'N/A'}</div>` +
                 `<div style="font-size:12px; color:${suspended ? '#b91c1c' : '#16a34a'}">${statusLabel}</div>`
             );
           });
       };
 
     ensureLeaflet();
 
     return () => {
       if (mapInstance) {
         mapInstance.remove();
       }
       const mapElement = document.getElementById('provider-map');
       if (mapElement) {
         mapElement.dataset.ready = 'false';
         mapElement.innerHTML = '';
       }
     };
   }, [providers]);
 }
 
+function BillingActionsPanel({
+  resolvedCharges,
+  selectedChargeIds,
+  toggleAllChargesSelection,
+  toggleChargeSelection,
+  setChargesPaidState,
+  updateSingleChargeStatus,
+  billingCycleStart,
+  suspensionCutoffLabel,
+}) {
+  return (
+    <>
+      <div style={{ overflowX: 'auto' }}>
+        <table style={{ width: '100%', borderCollapse: 'collapse', minWidth: '720px' }}>
+          <thead>
+            <tr style={{ textAlign: 'left', background: '#f3f4f6' }}>
+              <th style={{ padding: '10px' }}>
+                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
+                  <input type="checkbox" checked={selectedChargeIds.length === resolvedCharges.length} onChange={toggleAllChargesSelection} />
+                  <span>Select</span>
+                </div>
+              </th>
+              <th style={{ padding: '10px' }}>Provider</th>
+              <th style={{ padding: '10px' }}>Month</th>
+              <th style={{ padding: '10px' }}>Amount (GYD)</th>
+              <th style={{ padding: '10px' }}>Status</th>
+              <th style={{ padding: '10px' }}>Actions</th>
+            </tr>
+          </thead>
+          <tbody>
+            {resolvedCharges.map((charge) => {
+              const statusLabel = charge.isPaid ? 'Paid' : charge.isCurrentCycle ? 'Unpaid (current)' : 'Unpaid';
+              const badgeBackground = charge.isPaid ? '#dcfce7' : charge.isCurrentCycle ? '#fee2e2' : '#fef9c3';
+              const badgeColor = charge.isPaid ? '#15803d' : charge.isCurrentCycle ? '#b91c1c' : '#92400e';
+
+              return (
+                <tr key={charge.id} style={{ borderBottom: '1px solid #e5e7eb' }}>
+                  <td style={{ padding: '10px' }}>
+                    <input
+                      type="checkbox"
+                      checked={selectedChargeIds.includes(charge.id)}
+                      onChange={() => toggleChargeSelection(charge.id)}
+                    />
+                  </td>
+                  <td style={{ padding: '10px' }}>{charge.providerName}</td>
+                  <td style={{ padding: '10px' }}>{charge.month}</td>
+                  <td style={{ padding: '10px' }}>{charge.amount.toLocaleString()}</td>
+                  <td style={{ padding: '10px' }}>
+                    <span
+                      style={{
+                        padding: '4px 8px',
+                        borderRadius: '999px',
+                        background: badgeBackground,
+                        color: badgeColor,
+                        fontWeight: 700,
+                        fontSize: '12px',
+                      }}
+                    >
+                      {statusLabel}
+                    </span>
+                  </td>
+                  <td style={{ padding: '10px' }}>
+                    <div style={{ display: 'flex', gap: '8px' }}>
+                      <button
+                        onClick={() => updateSingleChargeStatus(charge.id, true)}
+                        style={{ padding: '8px 12px', background: '#16a34a', color: 'white', border: 'none', borderRadius: '8px', fontWeight: 700 }}
+                      >
+                        Mark Paid
+                      </button>
+                      <button
+                        onClick={() => updateSingleChargeStatus(charge.id, false)}
+                        style={{ padding: '8px 12px', background: '#f3f4f6', color: '#111827', border: '1px solid #e5e7eb', borderRadius: '8px', fontWeight: 700 }}
+                      >
+                        Mark Unpaid
+                      </button>
+                    </div>
+                  </td>
+                </tr>
+              );
+            })}
+          </tbody>
+        </table>
+      </div>
+      <div style={{ display: 'flex', gap: '10px', marginTop: '12px', flexWrap: 'wrap', alignItems: 'center' }}>
+        <button
+          onClick={() => setChargesPaidState(true)}
+          style={{ padding: '10px 14px', background: '#16a34a', color: 'white', border: 'none', borderRadius: '10px', fontWeight: 700 }}
+        >
+          Mark Paid
+        </button>
+        <button
+          onClick={() => setChargesPaidState(false)}
+          style={{ padding: '10px 14px', background: '#f3f4f6', color: '#111827', border: '1px solid #e5e7eb', borderRadius: '10px', fontWeight: 700 }}
+        >
+          Mark Unpaid
+        </button>
+        <div style={{ color: '#6b7280', fontSize: '14px' }}>
+          Charges default to <strong>Unpaid</strong> on the 1st of each month (current cycle: {billingCycleStart}). Accounts
+          automatically suspend at midnight on the 15th ({suspensionCutoffLabel}) if the current cycle remains unpaid.
+        </div>
+      </div>
+    </>
+  );
+}
+
+function ProviderAccountsTable({ providers, creditInputs, setCreditInputs, applyCredit, toggleLock }) {
+  return (
+    <div style={{ overflowX: 'auto' }}>
+      <table style={{ width: '100%', borderCollapse: 'collapse', minWidth: '920px' }}>
+        <thead>
+          <tr style={{ background: '#f3f4f6', textAlign: 'left' }}>
+            <th style={{ padding: '10px' }}>Provider</th>
+            <th style={{ padding: '10px' }}>Outstanding</th>
+            <th style={{ padding: '10px' }}>Credit</th>
+            <th style={{ padding: '10px' }}>Apply Credit</th>
+            <th style={{ padding: '10px' }}>Status</th>
+            <th style={{ padding: '10px' }}>Actions</th>
+          </tr>
+        </thead>
+        <tbody>
+          {providers.map((provider) => {
+            const suspended = provider.isLocked || provider.autoSuspended;
+            const statusLabel = provider.autoSuspended ? 'Suspended (Unpaid)' : provider.isLocked ? 'Suspended' : 'Active';
+            const toggleDisabled = provider.autoSuspended && !provider.isLocked;
+
+            return (
+              <tr key={provider.id} style={{ borderBottom: '1px solid #e5e7eb' }}>
+                <td style={{ padding: '10px' }}>
+                  <div style={{ fontWeight: 700 }}>{provider.name}</div>
+                  <div style={{ color: '#6b7280' }}>{provider.location}</div>
+                </td>
+                <td style={{ padding: '10px' }}>GYD {provider.outstanding.toLocaleString()}</td>
+                <td style={{ padding: '10px' }}>GYD {provider.credit.toLocaleString()}</td>
+                <td style={{ padding: '10px' }}>
+                  <div style={{ display: 'flex', gap: '8px' }}>
+                    <input
+                      type="number"
+                      placeholder="Amount"
+                      value={creditInputs[provider.id] || ''}
+                      onChange={(e) => setCreditInputs((prev) => ({ ...prev, [provider.id]: e.target.value }))}
+                      style={{ padding: '8px', borderRadius: '8px', border: '1px solid #d1d5db', width: '120px' }}
+                    />
+                    <button
+                      onClick={() => applyCredit(provider.id)}
+                      style={{
+                        background: '#16a34a',
+                        color: 'white',
+                        border: 'none',
+                        borderRadius: '8px',
+                        padding: '8px 10px',
+                        fontWeight: 700,
+                      }}
+                    >
+                      Apply
+                    </button>
+                  </div>
+                </td>
+                <td style={{ padding: '10px' }}>
+                  {suspended ? (
+                    <div style={{ display: 'grid', gap: '4px' }}>
+                      <span style={{ color: '#b91c1c', fontWeight: 700 }}>{statusLabel}</span>
+                      {provider.autoSuspended && (
+                        <span style={{ color: '#92400e', fontSize: '12px' }}>
+                          Auto-suspended on the 15th due to unpaid charges.
+                        </span>
+                      )}
+                    </div>
+                  ) : (
+                    <span style={{ color: '#15803d', fontWeight: 700 }}>Active</span>
+                  )}
+                </td>
+                <td style={{ padding: '10px' }}>
+                  <button
+                    onClick={() => toggleLock(provider.id)}
+                    disabled={toggleDisabled}
+                    style={{
+                      padding: '8px 12px',
+                      borderRadius: '8px',
+                      border: 'none',
+                      color: suspended ? '#16a34a' : 'white',
+                      background: suspended ? '#ecfdf3' : '#b91c1c',
+                      fontWeight: 700,
+                      opacity: toggleDisabled ? 0.6 : 1,
+                      cursor: toggleDisabled ? 'not-allowed' : 'pointer',
+                    }}
+                  >
+                    {provider.isLocked ? 'Unlock' : suspended ? 'Locked' : 'Lock'}
+                  </button>
+                  {toggleDisabled && (
+                    <div style={{ fontSize: '12px', color: '#6b7280', marginTop: '4px' }}>
+                      Set the charge to paid to restore the account.
+                    </div>
+                  )}
+                </td>
+              </tr>
+            );
+          })}
+        </tbody>
+      </table>
+    </div>
+  );
+}
+
 function AdminDashboard() {
-  const billingCycleStart = useMemo(() => {
-    const today = new Date();
-    return new Date(Date.UTC(today.getUTCFullYear(), today.getUTCMonth(), 1)).toISOString().slice(0, 10);
-  }, []);
+  const {
+    applyCredit,
+    billingCycleStart,
+    charges,
+    creditInputs,
+    loadingProviders,
+    providers,
+    resolvedCharges,
+    selectedChargeIds,
+    setCharges,
+    setCreditInputs,
+    setChargesPaidState,
+    suspensionCutoffLabel,
+    toggleAllChargesSelection,
+    toggleChargeSelection,
+    toggleLock,
+    updateSingleChargeStatus,
+  } = useBillingCore();
 
   const [serviceCharge, setServiceCharge] = useState(DEFAULT_SERVICE_CHARGE);
   const [serviceChargeDraft, setServiceChargeDraft] = useState(DEFAULT_SERVICE_CHARGE);
-  const [providers, setProviders] = useState(sampleProviders);
-  const [charges, setCharges] = useState(() =>
-    sampleCharges.map((charge) => {
-      const baseServiceCost = Math.round((charge.amount / DEFAULT_SERVICE_CHARGE) * 100);
-
-      return {
-        ...charge,
-        baseServiceCost,
-        isPaid: charge.month === billingCycleStart ? false : charge.isPaid ?? false,
-      };
-    }),
-  );
-  const [selectedChargeIds, setSelectedChargeIds] = useState([]);
-  const [creditInputs, setCreditInputs] = useState({});
-  const [loadingProviders, setLoadingProviders] = useState(false);
-  const [suspensionClock, setSuspensionClock] = useState(() => Date.now());
-  const suspensionCutoffLabel = useMemo(() => getSuspensionCutoffDate().toISOString().slice(0, 10), []);
 
   useLeafletMap(providers);
 
-  useEffect(() => {
-    const interval = setInterval(() => setSuspensionClock(Date.now()), 1000 * 60 * 30);
-    return () => clearInterval(interval);
-  }, []);
+  const recalculateChargesForRate = (rate) => {
+    const safeRate = normalizeServiceCharge(rate);
+    setCharges((prev) => prev.map((c) => ({ ...c, amount: Math.round(c.baseServiceCost * (safeRate / 100)) })));
+    setServiceCharge(safeRate);
+    setServiceChargeDraft(safeRate);
+  };
 
   useEffect(() => {
-    const fetchProviders = async () => {
-      try {
-        setLoadingProviders(true);
-        const res = await axios.get(`${API}/providers`);
-        if (Array.isArray(res.data) && res.data.length) {
-          const normalized = res.data.map((p) => ({
-            id: p.provider_id || p.id,
-            name: p.name || 'Provider',
-            location: p.location || 'Unknown area',
-            lat: p.lat,
-            long: p.long,
-            outstanding: Math.floor(Math.random() * 40000) + 5000,
-            credit: 0,
-            isLocked: false,
-            autoSuspended: false,
-            lastActive: '2024-10-10',
-            totalBookings: Math.floor(Math.random() * 40) + 5,
-            cancellations: Math.floor(Math.random() * 5),
-            noShows: Math.floor(Math.random() * 2),
-            services: p.services || [],
-          }));
-          setProviders(normalized);
-        }
-      } catch (e) {
-        console.log('Using sample providers', e.message);
-      } finally {
-        setLoadingProviders(false);
-      }
-    };
-
-    fetchProviders();
+    const storedRate = loadStoredServiceCharge();
+    if (storedRate !== null) {
+      recalculateChargesForRate(storedRate);
+    }
   }, []);
 
-  useEffect(() => {
-    const inSuspensionWindow = isPastSuspensionCutoff();
-
-    setProviders((prev) =>
-      prev.map((provider) => {
-        const hasUnpaidCurrentCharge = charges.some(
-          (charge) => charge.providerId === provider.id && charge.month === billingCycleStart && !charge.isPaid,
-        );
-        const autoSuspended = inSuspensionWindow && hasUnpaidCurrentCharge;
-
-        if (provider.autoSuspended === autoSuspended) return provider;
+  const saveServiceCharge = () => {
+    const safeRate = normalizeServiceCharge(serviceChargeDraft);
+    persistServiceCharge(safeRate);
+    recalculateChargesForRate(safeRate);
+  };
 
-        return { ...provider, autoSuspended };
-      }),
-    );
-  }, [billingCycleStart, charges, suspensionClock]);
+  const resetServiceCharge = () => {
+    recalculateChargesForRate(DEFAULT_SERVICE_CHARGE);
+    localStorage.removeItem(SERVICE_CHARGE_STORAGE_KEY);
+  };
 
   const totalProviders = providers.length;
   const totalActiveProviders = providers.filter((p) => {
     const lastActiveDate = new Date(p.lastActive);
     const thirtyDaysAgo = new Date();
     thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
     return lastActiveDate >= thirtyDaysAgo;
   }).length;
 
   const bookingStats = useMemo(() => {
     const now = new Date();
     const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
     const startOfWeek = new Date(startOfDay);
     startOfWeek.setDate(startOfDay.getDate() - startOfDay.getDay());
     const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
 
     const today = sampleBookings.filter((b) => new Date(b.startTime) >= startOfDay).length;
     const thisWeek = sampleBookings.filter((b) => new Date(b.startTime) >= startOfWeek).length;
     const thisMonth = sampleBookings.filter((b) => new Date(b.startTime) >= startOfMonth).length;
 
     const total = sampleBookings.length;
     const completed = sampleBookings.filter((b) => b.status === 'completed').length;
     const cancelled = sampleBookings.filter((b) => b.status === 'cancelled').length;
     const noShows = sampleBookings.filter((b) => b.status === 'no-show').length;
 
@@ -515,371 +839,138 @@ function AdminDashboard() {
 
   const bookingCountsByProvider = useMemo(() => {
     const counts = {};
     sampleBookings.forEach((b) => {
       counts[b.providerId] = (counts[b.providerId] || 0) + 1;
     });
     return counts;
   }, []);
 
   const providerById = useMemo(() => {
     const map = {};
     providers.forEach((p) => {
       map[p.id] = p;
     });
     return map;
   }, [providers]);
 
   const topProviders = Object.entries(bookingCountsByProvider)
     .sort((a, b) => b[1] - a[1])
     .slice(0, 3)
     .map(([providerId, count]) => ({
       name: providerById[providerId]?.name || `Provider ${providerId}`,
       bookings: count,
     }));
 
-  const applyCredit = (providerId) => {
-    const creditValue = Number(creditInputs[providerId] || 0);
-    if (!creditValue) return;
-    setProviders((prev) =>
-      prev.map((p) =>
-        p.id === providerId ? { ...p, credit: p.credit + creditValue, outstanding: Math.max(0, p.outstanding - creditValue) } : p,
-      ),
-    );
-    setCreditInputs((prev) => ({ ...prev, [providerId]: '' }));
-  };
-
-  const recalculateChargesForRate = (rate) => {
-    const safeRate = normalizeServiceCharge(rate);
-    setCharges((prev) => prev.map((c) => ({ ...c, amount: Math.round(c.baseServiceCost * (safeRate / 100)) })));
-    setServiceCharge(safeRate);
-    setServiceChargeDraft(safeRate);
-  };
-
-  useEffect(() => {
-    const storedRate = loadStoredServiceCharge();
-    if (storedRate !== null) {
-      recalculateChargesForRate(storedRate);
-    }
-  }, []);
-
-  const saveServiceCharge = () => {
-    const safeRate = normalizeServiceCharge(serviceChargeDraft);
-    persistServiceCharge(safeRate);
-    recalculateChargesForRate(safeRate);
-  };
-
-  const resetServiceCharge = () => {
-    recalculateChargesForRate(DEFAULT_SERVICE_CHARGE);
-    localStorage.removeItem(SERVICE_CHARGE_STORAGE_KEY);
-  };
-
-  const toggleLock = (providerId) => {
-    setProviders((prev) => prev.map((p) => (p.id === providerId ? { ...p, isLocked: !p.isLocked } : p)));
-  };
-
-  const toggleChargeSelection = (chargeId) => {
-    setSelectedChargeIds((prev) => (prev.includes(chargeId) ? prev.filter((id) => id !== chargeId) : [...prev, chargeId]));
-  };
-
-  const toggleAllChargesSelection = () => {
-    if (selectedChargeIds.length === charges.length) {
-      setSelectedChargeIds([]);
-    } else {
-      setSelectedChargeIds(charges.map((c) => c.id));
-    }
-  };
-
-  const setChargesPaidState = (paidState) => {
-    setCharges((prev) => prev.map((c) => (selectedChargeIds.includes(c.id) ? { ...c, isPaid: paidState } : c)));
-    setSelectedChargeIds([]);
-  };
-
-  const updateSingleChargeStatus = (chargeId, paidState) => {
-    setCharges((prev) => prev.map((c) => (c.id === chargeId ? { ...c, isPaid: paidState } : c)));
-    setSelectedChargeIds((prev) => prev.filter((id) => id !== chargeId));
-  };
-
-  const resolvedCharges = charges.map((charge) => ({
-    ...charge,
-    providerName: providerById[charge.providerId]?.name || 'Provider',
-    isCurrentCycle: charge.month === billingCycleStart,
-  }));
-
   const dau = 48;
   const mau = 620;
   const revenueTotal = charges.reduce((acc, c) => acc + c.amount, 0);
   const averageBookingsPerProvider = providers.length ? (sampleBookings.length / providers.length).toFixed(1) : 0;
 
   return (
     <div style={{ background: '#f9fafb', minHeight: '100vh', padding: '24px' }}>
       <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
         <h1 style={{ fontSize: '28px', fontWeight: 800, color: '#111827' }}>Admin Dashboard</h1>
         <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>
           <Link to="/" style={{ color: '#16a34a', fontWeight: 600 }}>Home</Link>
           <Link to="/login" style={{ color: '#16a34a', fontWeight: 600 }}>Login</Link>
         </div>
       </div>
 
       <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(220px, 1fr))', gap: '12px', marginBottom: '20px' }}>
         <StatCard label="Total Providers" value={totalProviders} helper="Across all regions" />
         <StatCard label="Active Providers (30d)" value={totalActiveProviders} helper="Visited in last 30 days" />
         <StatCard label="Total Clients" value={420} helper="Includes mobile + web" />
         <StatCard label="DAU / MAU" value={`${dau} / ${mau}`} helper={`${Math.round((dau / mau) * 100)}% engagement`} />
       </div>
 
       <div style={{ display: 'grid', gridTemplateColumns: '2fr 1fr', gap: '16px', marginBottom: '16px' }}>
         <ReportSection title="Service Charge & Billing Controls">
           <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', alignItems: 'center' }}>
             <div>
               <div style={{ color: '#6b7280', fontSize: '12px', textTransform: 'uppercase', letterSpacing: '0.04em' }}>Service Charge</div>
               <div style={{ display: 'flex', gap: '8px', alignItems: 'center', marginTop: '4px' }}>
                 <input
                   type="number"
                   min="0"
                   max="100"
                   value={serviceChargeDraft}
                   onChange={(e) => setServiceChargeDraft(Number(e.target.value))}
-                  style={{ padding: '10px', borderRadius: '8px', border: '1px solid #d1d5db', width: '120px' }}
+                  style={{ padding: '10px', borderRadius: '10px', border: '1px solid #d1d5db', maxWidth: '160px' }}
                 />
-                <span style={{ color: '#9ca3af' }}>
+                <span style={{ color: '#6b7280', fontSize: '14px' }}>
                   % of service cost (default {DEFAULT_SERVICE_CHARGE}%). Current billing cycle starts {billingCycleStart}. Saved rate: {serviceCharge}%.
                 </span>
               </div>
             </div>
             <div style={{ display: 'flex', gap: '8px', justifyContent: 'flex-end' }}>
               <button
                 style={{ padding: '10px 14px', background: '#16a34a', color: 'white', borderRadius: '10px', border: 'none', fontWeight: 700 }}
                 onClick={saveServiceCharge}
               >
                 Save Changes
               </button>
               <button
                 style={{ padding: '10px 14px', background: '#f3f4f6', color: '#111827', borderRadius: '10px', border: '1px solid #e5e7eb', fontWeight: 700 }}
                 onClick={resetServiceCharge}
               >
                 Reset to {DEFAULT_SERVICE_CHARGE}%
               </button>
             </div>
           </div>
         </ReportSection>
 
         <ReportSection title="Booking Health">
           <div style={{ display: 'grid', gap: '8px' }}>
             <StatCard label="Bookings Today" value={bookingStats.today} />
             <StatCard label="Bookings This Week" value={bookingStats.thisWeek} />
             <StatCard label="Bookings This Month" value={bookingStats.thisMonth} />
           </div>
         </ReportSection>
       </div>
 
       <ReportSection title="Billing Actions">
-        <div style={{ overflowX: 'auto' }}>
-          <table style={{ width: '100%', borderCollapse: 'collapse', minWidth: '720px' }}>
-            <thead>
-              <tr style={{ textAlign: 'left', background: '#f3f4f6' }}>
-                <th style={{ padding: '10px' }}>
-                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
-                    <input type="checkbox" checked={selectedChargeIds.length === charges.length} onChange={toggleAllChargesSelection} />
-                    <span>Select</span>
-                  </div>
-                </th>
-                <th style={{ padding: '10px' }}>Provider</th>
-                <th style={{ padding: '10px' }}>Month</th>
-                <th style={{ padding: '10px' }}>Amount (GYD)</th>
-                <th style={{ padding: '10px' }}>Status</th>
-                <th style={{ padding: '10px' }}>Actions</th>
-              </tr>
-            </thead>
-            <tbody>
-              {resolvedCharges.map((charge) => {
-                const statusLabel = charge.isPaid ? 'Paid' : charge.isCurrentCycle ? 'Unpaid (current)' : 'Unpaid';
-                const badgeBackground = charge.isPaid ? '#dcfce7' : charge.isCurrentCycle ? '#fee2e2' : '#fef9c3';
-                const badgeColor = charge.isPaid ? '#15803d' : charge.isCurrentCycle ? '#b91c1c' : '#92400e';
-
-                return (
-                  <tr key={charge.id} style={{ borderBottom: '1px solid #e5e7eb' }}>
-                    <td style={{ padding: '10px' }}>
-                      <input
-                        type="checkbox"
-                        checked={selectedChargeIds.includes(charge.id)}
-                        onChange={() => toggleChargeSelection(charge.id)}
-                      />
-                    </td>
-                    <td style={{ padding: '10px' }}>{charge.providerName}</td>
-                    <td style={{ padding: '10px' }}>{charge.month}</td>
-                    <td style={{ padding: '10px' }}>{charge.amount.toLocaleString()}</td>
-                    <td style={{ padding: '10px' }}>
-                      <span
-                        style={{
-                          padding: '4px 8px',
-                          borderRadius: '999px',
-                          background: badgeBackground,
-                          color: badgeColor,
-                          fontWeight: 700,
-                          fontSize: '12px',
-                        }}
-                      >
-                        {statusLabel}
-                      </span>
-                    </td>
-                    <td style={{ padding: '10px' }}>
-                      <div style={{ display: 'flex', gap: '8px' }}>
-                        <button
-                          onClick={() => updateSingleChargeStatus(charge.id, true)}
-                          style={{ padding: '8px 12px', background: '#16a34a', color: 'white', border: 'none', borderRadius: '8px', fontWeight: 700 }}
-                        >
-                          Mark Paid
-                        </button>
-                        <button
-                          onClick={() => updateSingleChargeStatus(charge.id, false)}
-                          style={{ padding: '8px 12px', background: '#f3f4f6', color: '#111827', border: '1px solid #e5e7eb', borderRadius: '8px', fontWeight: 700 }}
-                        >
-                          Mark Unpaid
-                        </button>
-                      </div>
-                    </td>
-                  </tr>
-                );
-              })}
-            </tbody>
-          </table>
-        </div>
-        <div style={{ display: 'flex', gap: '10px', marginTop: '12px', flexWrap: 'wrap', alignItems: 'center' }}>
-          <button
-            onClick={() => setChargesPaidState(true)}
-            style={{ padding: '10px 14px', background: '#16a34a', color: 'white', border: 'none', borderRadius: '10px', fontWeight: 700 }}
-          >
-            Mark Paid
-          </button>
-          <button
-            onClick={() => setChargesPaidState(false)}
-            style={{ padding: '10px 14px', background: '#f3f4f6', color: '#111827', border: '1px solid #e5e7eb', borderRadius: '10px', fontWeight: 700 }}
-          >
-            Mark Unpaid
-          </button>
-          <div style={{ color: '#6b7280', fontSize: '14px' }}>
-            Charges default to <strong>Unpaid</strong> on the 1st of each month (current cycle: {billingCycleStart}). Accounts
-            automatically suspend at midnight on the 15th ({suspensionCutoffLabel}) if the current cycle remains unpaid.
-          </div>
-        </div>
+        <BillingActionsPanel
+          billingCycleStart={billingCycleStart}
+          resolvedCharges={resolvedCharges}
+          selectedChargeIds={selectedChargeIds}
+          setChargesPaidState={setChargesPaidState}
+          suspensionCutoffLabel={suspensionCutoffLabel}
+          toggleAllChargesSelection={toggleAllChargesSelection}
+          toggleChargeSelection={toggleChargeSelection}
+          updateSingleChargeStatus={updateSingleChargeStatus}
+        />
       </ReportSection>
 
       <ReportSection title="Provider Accounts">
-        <div style={{ overflowX: 'auto' }}>
-          <table style={{ width: '100%', borderCollapse: 'collapse', minWidth: '920px' }}>
-            <thead>
-              <tr style={{ background: '#f3f4f6', textAlign: 'left' }}>
-                <th style={{ padding: '10px' }}>Provider</th>
-                <th style={{ padding: '10px' }}>Outstanding</th>
-                <th style={{ padding: '10px' }}>Credit</th>
-                <th style={{ padding: '10px' }}>Apply Credit</th>
-                <th style={{ padding: '10px' }}>Status</th>
-                <th style={{ padding: '10px' }}>Actions</th>
-              </tr>
-            </thead>
-            <tbody>
-              {providers.map((provider) => {
-                const suspended = provider.isLocked || provider.autoSuspended;
-                const statusLabel = provider.autoSuspended ? 'Suspended (Unpaid)' : provider.isLocked ? 'Suspended' : 'Active';
-                const toggleDisabled = provider.autoSuspended && !provider.isLocked;
-
-                return (
-                  <tr key={provider.id} style={{ borderBottom: '1px solid #e5e7eb' }}>
-                    <td style={{ padding: '10px' }}>
-                      <div style={{ fontWeight: 700 }}>{provider.name}</div>
-                      <div style={{ color: '#6b7280' }}>{provider.location}</div>
-                    </td>
-                    <td style={{ padding: '10px' }}>GYD {provider.outstanding.toLocaleString()}</td>
-                    <td style={{ padding: '10px' }}>GYD {provider.credit.toLocaleString()}</td>
-                    <td style={{ padding: '10px' }}>
-                      <div style={{ display: 'flex', gap: '8px' }}>
-                        <input
-                          type="number"
-                          placeholder="Amount"
-                          value={creditInputs[provider.id] || ''}
-                          onChange={(e) => setCreditInputs((prev) => ({ ...prev, [provider.id]: e.target.value }))}
-                          style={{ padding: '8px', borderRadius: '8px', border: '1px solid #d1d5db', width: '120px' }}
-                        />
-                        <button
-                          onClick={() => applyCredit(provider.id)}
-                          style={{
-                            background: '#16a34a',
-                            color: 'white',
-                            border: 'none',
-                            borderRadius: '8px',
-                            padding: '8px 10px',
-                            fontWeight: 700,
-                          }}
-                        >
-                          Apply
-                        </button>
-                      </div>
-                    </td>
-                    <td style={{ padding: '10px' }}>
-                      {suspended ? (
-                        <div style={{ display: 'grid', gap: '4px' }}>
-                          <span style={{ color: '#b91c1c', fontWeight: 700 }}>{statusLabel}</span>
-                          {provider.autoSuspended && (
-                            <span style={{ color: '#92400e', fontSize: '12px' }}>
-                              Auto-suspended on the 15th due to unpaid charges.
-                            </span>
-                          )}
-                        </div>
-                      ) : (
-                        <span style={{ color: '#15803d', fontWeight: 700 }}>Active</span>
-                      )}
-                    </td>
-                    <td style={{ padding: '10px' }}>
-                      <button
-                        onClick={() => toggleLock(provider.id)}
-                        disabled={toggleDisabled}
-                        style={{
-                          padding: '8px 12px',
-                          borderRadius: '8px',
-                          border: 'none',
-                          color: suspended ? '#16a34a' : 'white',
-                          background: suspended ? '#ecfdf3' : '#b91c1c',
-                          fontWeight: 700,
-                          opacity: toggleDisabled ? 0.6 : 1,
-                          cursor: toggleDisabled ? 'not-allowed' : 'pointer',
-                        }}
-                      >
-                        {provider.isLocked ? 'Unlock' : suspended ? 'Locked' : 'Lock'}
-                      </button>
-                      {toggleDisabled && (
-                        <div style={{ fontSize: '12px', color: '#6b7280', marginTop: '4px' }}>
-                          Set the charge to paid to restore the account.
-                        </div>
-                      )}
-                    </td>
-                  </tr>
-                );
-              })}
-            </tbody>
-          </table>
-        </div>
+        <ProviderAccountsTable
+          applyCredit={applyCredit}
+          creditInputs={creditInputs}
+          providers={providers}
+          setCreditInputs={setCreditInputs}
+          toggleLock={toggleLock}
+        />
       </ReportSection>
 
       <div style={{ display: 'grid', gridTemplateColumns: '2fr 1fr', gap: '16px', marginBottom: '16px' }}>
         <ReportSection title="Signups Over Time">
           <div style={{ display: 'grid', gap: '8px' }}>
             {signupHistory.map((item) => (
               <div key={item.month} style={{ border: '1px solid #e5e7eb', borderRadius: '10px', padding: '10px', background: '#f9fafb' }}>
                 <div style={{ fontWeight: 700 }}>{item.month}</div>
                 <ProgressRow label="Providers" value={item.providers} total={50} accent="#16a34a" />
                 <ProgressRow label="Clients" value={item.clients} total={120} accent="#0ea5e9" />
               </div>
             ))}
           </div>
         </ReportSection>
 
         <ReportSection title="Bookings & Revenue">
           <div style={{ display: 'grid', gap: '8px' }}>
             <StatCard label="Completion Rate" value={`${bookingStats.completionRate}%`} />
             <StatCard label="Cancellation Rate" value={`${bookingStats.cancellationRate}%`} />
             <StatCard label="No-show Rate" value={`${bookingStats.noShowRate}%`} />
             <StatCard label="Revenue to Date" value={`GYD ${revenueTotal.toLocaleString()}`} />
           </div>
         </ReportSection>
       </div>
 
@@ -925,85 +1016,185 @@ function AdminDashboard() {
               <li>East Bank showing search results with no barbers on weekdays.</li>
             </ul>
           </div>
           <div>
             <h4 style={{ marginTop: 0 }}>Financial Health</h4>
             <ul style={{ paddingLeft: '16px', color: '#111827' }}>
               <li>Revenue per provider trending at GYD 12,500 monthly average.</li>
               <li>Credit balances outstanding: GYD {(providers.reduce((acc, p) => acc + p.credit, 0)).toLocaleString()}.</li>
               <li>Failed subscription payments: 1 in the last 30 days.</li>
               <li>Referral payouts pending: GYD 8,000.</li>
             </ul>
           </div>
         </div>
       </ReportSection>
 
       <ReportSection title="Provider Map">
         <div style={{ height: '420px', borderRadius: '12px', overflow: 'hidden', border: '1px solid #e5e7eb', background: '#f3f4f6' }}>
           <div id="provider-map" style={{ height: '100%', width: '100%' }}></div>
         </div>
         {loadingProviders && <div style={{ marginTop: '8px', color: '#6b7280' }}>Loading provider pins…</div>}
       </ReportSection>
     </div>
   );
 }
 
+
+
+function BillingManagement() {
+  const {
+    applyCredit,
+    billingCycleStart,
+    creditInputs,
+    providers,
+    resolvedCharges,
+    selectedChargeIds,
+    setChargesPaidState,
+    suspensionCutoffLabel,
+    toggleAllChargesSelection,
+    toggleChargeSelection,
+    toggleLock,
+    updateSingleChargeStatus,
+    setCreditInputs,
+  } = useBillingCore();
+
+  const unpaidCharges = resolvedCharges.filter((c) => !c.isPaid);
+  const outstandingBalance = providers.reduce((acc, p) => acc + p.outstanding, 0);
+
+  return (
+    <div style={{ padding: '28px', background: '#f9fafb', minHeight: '100vh' }}>
+      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
+        <div>
+          <h1 style={{ margin: 0, fontSize: '28px', fontWeight: 800, color: '#111827' }}>Billing Center</h1>
+          <p style={{ margin: '4px 0 0', color: '#6b7280' }}>
+            Mark charges paid in bulk or individually. New cycles start unpaid on the 1st; unpaid accounts auto-suspend at
+            midnight on the 15th.
+          </p>
+        </div>
+        <Link to="/admin" style={{ color: '#16a34a', fontWeight: 700, textDecoration: 'none' }}>
+          ← Back to dashboard
+        </Link>
+      </div>
+
+      <div
+        style={{
+          display: 'grid',
+          gridTemplateColumns: 'repeat(auto-fit, minmax(220px, 1fr))',
+          gap: '12px',
+          marginBottom: '16px',
+        }}
+      >
+        <StatCard label="Billing cycle start" value={billingCycleStart} helper="Unpaid by default on this date" />
+        <StatCard label="Auto-suspension" value={suspensionCutoffLabel} helper="Midnight cutoff on the 15th" />
+        <StatCard label="Unpaid charges" value={`${unpaidCharges.length}`} helper={`${selectedChargeIds.length} selected`} />
+        <StatCard
+          label="Outstanding balance"
+          value={`GYD ${outstandingBalance.toLocaleString()}`}
+          helper="Across all providers"
+        />
+      </div>
+
+      <ReportSection title="Charge Management">
+        <BillingActionsPanel
+          billingCycleStart={billingCycleStart}
+          resolvedCharges={resolvedCharges}
+          selectedChargeIds={selectedChargeIds}
+          setChargesPaidState={setChargesPaidState}
+          suspensionCutoffLabel={suspensionCutoffLabel}
+          toggleAllChargesSelection={toggleAllChargesSelection}
+          toggleChargeSelection={toggleChargeSelection}
+          updateSingleChargeStatus={updateSingleChargeStatus}
+        />
+      </ReportSection>
+
+      <ReportSection title="Provider Status & Credits">
+        <ProviderAccountsTable
+          applyCredit={applyCredit}
+          creditInputs={creditInputs}
+          providers={providers}
+          setCreditInputs={setCreditInputs}
+          toggleLock={toggleLock}
+        />
+      </ReportSection>
+    </div>
+  );
+}
+
+
 function AdminLayout() {
   return (
     <div style={{ display: 'grid', gridTemplateColumns: '260px 1fr', minHeight: '100vh', background: '#e5e7eb' }}>
       <aside
         style={{
           background: '#111827',
           color: '#f9fafb',
           padding: '24px 18px',
           display: 'flex',
           flexDirection: 'column',
           gap: '16px',
           boxShadow: '4px 0 16px rgba(0,0,0,0.15)',
         }}
       >
         <div style={{ fontWeight: 800, fontSize: '20px', letterSpacing: '0.02em' }}>Admin Panel</div>
         <nav style={{ display: 'grid', gap: '8px' }}>
           <NavLink
             to="/admin"
             end
             style={({ isActive }) => ({
               display: 'flex',
               flexDirection: 'column',
               gap: '2px',
               padding: '12px',
               borderRadius: '10px',
               textDecoration: 'none',
               color: 'inherit',
               background: isActive ? '#0ea5e9' : 'rgba(255,255,255,0.04)',
               border: isActive ? '1px solid rgba(255,255,255,0.35)' : '1px solid rgba(255,255,255,0.08)',
               fontWeight: 700,
             })}
           >
             <span>Dashboard</span>
             <span style={{ fontSize: '12px', color: 'rgba(255,255,255,0.8)', fontWeight: 500 }}>Overview</span>
           </NavLink>
+          <NavLink
+            to="/admin/billing"
+            style={({ isActive }) => ({
+              display: 'flex',
+              flexDirection: 'column',
+              gap: '2px',
+              padding: '12px',
+              borderRadius: '10px',
+              textDecoration: 'none',
+              color: 'inherit',
+              background: isActive ? '#10b981' : 'rgba(255,255,255,0.04)',
+              border: isActive ? '1px solid rgba(255,255,255,0.35)' : '1px solid rgba(255,255,255,0.08)',
+              fontWeight: 700,
+            })}
+          >
+            <span>Billing</span>
+            <span style={{ fontSize: '12px', color: 'rgba(255,255,255,0.8)', fontWeight: 500 }}>Mark payments</span>
+          </NavLink>
           <NavLink
             to="/admin/service-charge"
             style={({ isActive }) => ({
               display: 'flex',
               flexDirection: 'column',
               gap: '2px',
               padding: '12px',
               borderRadius: '10px',
               textDecoration: 'none',
               color: 'inherit',
               background: isActive ? '#16a34a' : 'rgba(255,255,255,0.04)',
               border: isActive ? '1px solid rgba(255,255,255,0.35)' : '1px solid rgba(255,255,255,0.08)',
               fontWeight: 700,
             })}
           >
             <span>Service Charge</span>
             <span style={{ fontSize: '12px', color: 'rgba(255,255,255,0.8)', fontWeight: 500 }}>Adjust admin fee</span>
           </NavLink>
         </nav>
         <div style={{ marginTop: 'auto', fontSize: '12px', color: 'rgba(255,255,255,0.7)' }}>
           Billing settings persist between sessions.
         </div>
       </aside>
       <main style={{ minHeight: '100vh', background: '#f9fafb' }}>
         <Outlet />
@@ -1092,31 +1283,32 @@ export default function App() {
     }
   }, [token]);
 
   const ProtectedRoute = ({ children }) => {
     const location = useLocation();
     if (!token) {
       return <Navigate to="/login" replace state={{ from: location }} />;
     }
     return children;
   };
 
   return (
     <BrowserRouter>
       <Routes>
         <Route path="/" element={<Home />} />
         <Route path="/login" element={<Login onLogin={setToken} />} />
         <Route
           path="/admin"
           element={(
             <ProtectedRoute>
               <AdminLayout />
             </ProtectedRoute>
           )}
           >
           <Route index element={<AdminDashboard />} />
+          <Route path="billing" element={<BillingManagement />} />
           <Route path="service-charge" element={<ServiceChargeSettings />} />
         </Route>
       </Routes>
     </BrowserRouter>
   );
 }
 
EOF
)